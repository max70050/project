<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hilfe-Plattform (Demo)</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <h1 class="logo"><a href="#home">Hilfe-Plattform</a></h1>
      <p class="tagline">Jugendliche helfen – Senioren bekommen Unterstützung</p>
    </div>
  </header>

<nav class="site-nav">
  <div class="wrap">
    <a href="#home">Anzeigen</a>
    <a href="#watchlist" data-requires-auth hidden>Beobachtungsliste</a>
    <a href="#myAds" data-requires-auth hidden>Deine Anzeigen</a>
    <a href="#nachrichten" data-requires-auth hidden>Nachrichten</a>
    <a href="#stats" data-admin-only hidden>Statistiken</a>
    <a href="#about">Über uns</a>
    <a href="#new" class="cta" data-requires-auth hidden>Anzeige erstellen</a>

    <div class="nav-auth">
        <div id="notification-bell-container" class="notification-bell-container" hidden>
            <button id="notification-bell-btn" class="notification-bell" aria-label="Benachrichtigungen">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                <span id="notification-counter" class="notification-counter" hidden>0</span>
            </button>
            <div id="notifications-panel" class="notifications-panel" hidden>
                <div class="notifications-header">
                    <h3>Benachrichtigungen</h3>
                </div>
                <div id="notifications-list" class="notifications-list">
                    </div>
                <p id="notifications-empty" class="empty-hint" style="margin: 20px 0;">Keine neuen Benachrichtigungen.</p>
            </div>
        </div>
        <a href="#profile" id="user-profile-nav" class="user-profile-link" hidden>
            <img id="nav-avatar" src="" alt="Mein Avatar" class="nav-avatar">
            <span id="user-status-text"></span>
        </a>
        <a href="#" id="auth-btn" class="cta secondary">Anmelden</a>
    </div>
  </div>
</nav>

  <main class="wrap">
    <section id="view-home" class="view">
      <h2>Aktuelle Anzeigen</h2>

      <div class="filters">
        <label>
          Kategorie
          <select id="filter-category">
            <option value="">Alle</option>
            <option>Gartenarbeit</option>
            <option>Einkaufen</option>
            <option>Haushalt</option>
            <option>Sonstiges</option>
          </select>
        </label>
        <label>
          Stadt/Ort
          <input id="filter-location" type="text" placeholder="z. B. Köln" />
        </label>
        <button id="btn-clear-filters" type="button">Filter zurücksetzen</button>
      </div>

      <div id="ads-list" class="ads-list"></div>
      <p id="home-empty" class="empty-hint" hidden>Keine Anzeigen gefunden.</p>
    </section>



  <section id="view-about" class="view" hidden>
    <br>
    <h2>Über uns</h2>
    <p>
      Die Hilfe-Plattform ist eine Initiative, die Jugendliche und Senioren in der Gemeinschaft zusammenbringt. Unser Ziel ist es, älteren Menschen bei alltäglichen Aufgaben wie Gartenarbeit, Einkäufen oder Haushaltsführung zu unterstützen. Gleichzeitig bietet die Plattform Jugendlichen die Möglichkeit, Verantwortung zu übernehmen, sich in ihrer Nachbarschaft zu engagieren und dabei noch etwas Geld zu verdienen.
    </p>
    <p>
      Wir glauben an die Kraft der Gemeinschaft und daran, dass ein Miteinander der Generationen das Leben für alle bereichert. Jede Anzeige, die auf unserer Plattform erstellt wird, ist ein Schritt in Richtung einer stärkeren, hilfsbereiteren Gemeinschaft.
    </p>

    <h3>Kontakt</h3>
    <p>
      Für Fragen, Anregungen oder Feedback kannst du uns gerne kontaktieren. Wir freuen uns auf deine Nachricht!
    </p>
    <label><stong>Email:</stong></label>
    <a href=">help4you@gmail.com">help4you@gmail.com</a>
    <br>
    <br>
    <label><stong>Telefon:</stong></label>
    <a href="tel:+49 123 456789">+49 123 456789</a>
    <br>
    <br>
    <label><stong>Instagramm:</stong></label>
    <a href="Help4You">Help4You</a>
    <br>
  </section>

    <section id="view-detail" class="view" hidden>
      <button id="btn-back" class="btn-link" type="button">← Zurück</button>
      <article id="detail-card" class="detail-card"></article>
    </section>

    <section id="view-public-profile" class="view" hidden>
      <button id="btn-back-from-profile" class="btn-link" type="button">← Zurück zur Anzeige</button>
      <div id="public-profile-header">
        <img id="public-profile-avatar" src="" alt="Profilbild" class="profile-avatar-preview" style="width: 80px; height: 80px;">
        <div class="public-profile-info">
          <h2 id="public-profile-username"></h2>
          <p id="public-profile-ad-count"></p>
        </div>
        <div id="follow-button-container" class="follow-button-container"></div>
        </div>
      <h3>Anzeigen von diesem Nutzer</h3>
      <div id="public-profile-ads-list" class="ads-list"></div>
      <p id="public-profile-no-ads" class="empty-hint" hidden>Dieser Nutzer hat aktuell keine aktiven Anzeigen.</p>
    </section>

    <section id="view-watchlist" class="view" hidden>
      <h2>Beobachtungsliste</h2>
      <div id="watch-list" class="ads-list"></div>
      <p id="watch-empty" class="empty-hint" hidden>Noch keine Anzeigen in der Beobachtungsliste.</p>
    </section>

    <section id="view-new" class="view" hidden>
      <h2>Neue Anzeige erstellen</h2>
      <form id="ad-form" class="form-grid" autocomplete="off">
        <label>
  Titel
  <input id="f-title" type="text" required placeholder="z. B. Schnee schippen" minlength="10" maxlength="35" />
</label>

        <label>
  Stadt/Ort
  <input id="f-location" type="text" required placeholder="z. B. Köln Gladbach" maxlength="30" />
</label>
        <label>
          Kategorie
          <select id="f-category" required>
            <option value="" disabled selected>Bitte wählen</option>
            <option>Gartenarbeit</option>
            <option>Einkaufen</option>
            <option>Haushalt</option>
            <option>Sonstiges</option>
          </select>
        </label>

        <label>
          Schwierigkeitsgrad
          <select id="f-difficulty" required>
            <option value="" disabled selected>Bitte wählen</option>
            <option>leicht</option>
            <option>mittel</option>
            <option>anstrengend</option>
          </select>
        </label>

        <label>
  Dauer / Fläche
  <input id="f-size" type="text" placeholder="z. B. ca. 2 Std. oder 20 m²" maxlength="30" />
</label>>

        <label>
          Bezahlung
          <select id="f-payment-type" required>
            <option value="fest" selected>Festpreis (€)</option>
            <option value="vb">Verhandlungsbasis</option>
          </select>
        </label>

        <div id="price-input-container">
          <label id="price-label">
          Betrag in €
          <input id="f-payment" type="number" min="0" max="150" step="1" inputmode="numeric" placeholder="z. B. 15 (max.150)" />
        </label>
        </div>

        <div class="span-2">
            <label>Werden Geräte/Werkzeuge gestellt?</label>
            <div class="radio-group">
                <label>
                    <input type="radio" name="f-tools" value="Ja" required>
                    <span>Ja</span>
                </label>
                <label>
                    <input type="radio" name="f-tools" value="Nein">
                    <span>Nein</span>
                </label>
                <label>
                    <input type="radio" name="f-tools" value="Nach Absprache">
                    <span>Nach Absprache</span>
                </label>
            </div>
        </div>
        <div class="span-2">
          <label>Bilder hinzufügen</label>
          <div class="upload-actions">
            <button type="button" id="btn-pick-gallery" class="secondary">Aus Galerie wählen</button>
            <button type="button" id="btn-pick-camera" class="secondary">Foto aufnehmen</button>
          </div>
          <small id="image-upload-hint" class="field-hint error" hidden></small>
          <input id="f-images" type="file" accept="image/*" multiple hidden />
          <input id="f-images-camera" type="file" accept="image/*" capture="environment" multiple hidden />
          <div id="preview-container" class="preview-container" data-sortable>
              <p class="drop-hint">Hier werden deine Bilder angezeigt. Du kannst sie per Drag & Drop sortieren.</p>
          </div>
        </div>

        <label class="span-2">
          Beschreibung
          <textarea id="f-desc" rows="5" required minlength="20" maxlength="500" placeholder="Beschreibe kurz, wobei Hilfe gebraucht wird (min. 20, max. 500 Zeichen)"></textarea>
        </label>

        <div class="form-actions span-2">
          <button type="submit">Anzeige speichern</button>
          <button id="btn-discard" type="button" class="secondary">Verwerfen</button>
        </div>
      </form>

      <p class="note">
        <em>Demo: Daten bleiben nur im Browser (localStorage).</em>
      </p>
    </section>

    <section id="view-my-ads" class="view" hidden>
      <h2>Deine Anzeigen</h2>
      <div id="my-ads-list" class="ads-list"></div>
      <p id="my-ads-empty" class="empty-hint" hidden>Du hast noch keine Anzeigen erstellt.</p>
    </section>

    <section id="view-nachrichten" class="view" hidden>
      <h2>Nachrichten</h2>
      <p class="empty-hint">Hier werden bald deine Chats angezeigt.</p>
    </section>

    <section id="view-stats" class="view" hidden>
      <h2>Statistiken & Admin-Tools</h2>
      <div class="admin-container">
        <div id="reported-ads-panel" class="span-2">
          <h3>Gemeldete Anzeigen</h3>
          <div id="reported-ads-list"></div>
          <p id="reported-ads-empty" class="empty-hint" hidden>Aktuell gibt es keine neuen Meldungen.</p>
        </div>
        <div class="admin-search-panel">
          <h3>Anzeige per ID suchen</h3>
          <p>Finde jede Anzeige (auch gelöschte) über ihre eindeutige ID.</p>
          <form id="admin-search-form" class="admin-search-form">
            <input type="text" id="admin-search-input" placeholder="z.B. AD-ID-A1B2C" required>
            <button type="submit">Suchen</button>
          </form>
        </div>
        <div class="admin-deleted-panel">
          <h3>Zuletzt deaktivierte Anzeigen (letzte 50)</h3>
          <div id="deleted-ads-list"></div>
           <p id="deleted-ads-empty" class="empty-hint" hidden>Es wurden noch keine Anzeigen deaktiviert.</p>
        </div>
        <div class="admin-old-deleted-panel span-2">
            <h3>Endgültig löschen</h3>
            <p>
                Diese Anzeigen wurden vor mehr als 60 Tagen deaktiviert und können nun permanent vom Server entfernt werden. <strong>Diese Aktion kann nicht rückgängig gemacht werden.</strong>
            </p>
            <div id="old-deleted-ads-list"></div>
            <p id="old-deleted-ads-empty" class="empty-hint" hidden>Keine Anzeigen gefunden, die älter als 60 Tage sind.</p>
        </div>
      </div>
      <p class="empty-hint" id="stats-no-admin-hint">Diese Seite ist nur für Administratoren sichtbar.</p>
    </section>
    
    <section id="view-profile" class="view" hidden>
      <h2>Mein Profil</h2>
      <form id="profile-form" class="profile-grid">

        <div class="profile-avatar-container span-2">
            <img id="p-avatar-preview" src=""  class="profile-avatar-preview">
            <div class="profile-avatar-actions">
                <label for="p-avatar-upload" class="button small secondary">Bild ändern</label>
                <input type="file" id="p-avatar-upload" accept="image/png, image/jpeg" hidden>
                <button type="button" id="btn-delete-avatar" class="button small danger" hidden>Entfernen</button>
            </div>
        </div>

        <div id="color-palette-container" class="color-palette-container span-2">
            <label>Avatar-Farbe wählen</label>
            <div id="avatar-color-palette" class="color-palette">
                </div>
        </div>


          <div class="span-2">
              <p class="privacy-note">
                  Deine Daten sind sicher. Nur dein Benutzername ist für andere sichtbar. Alle anderen Informationen sind privat.
              </p>
          </div>

          <label>
              E-Mail-Adresse
              <input type="email" id="p-email" disabled placeholder="E-Mail-Adresse">
          </label>

          <label>
              Passwort
              <input type="password" id="p-password" disabled value="**********">
          </label>

          <label>
              Benutzername
              <input type="text" id="p-username" required minlength="3" maxlength="20">
              <small id="username-hint" class="field-hint" hidden>Du kannst deinen Benutzernamen 2-mal alle 30 Tage ändern.</small>
          </label>
          
          <span></span> <label>
              Vorname
              <input type="text" id="p-firstname" placeholder="Dein Vorname" maxlength="50">
          </label>

          <label>
              Nachname
              <input type="text" id="p-lastname" placeholder="Dein Nachname" maxlength="50">
          </label>

          <div class="address-section span-2">
            <h3>Adresse</h3>
            <div class="address-fields">
                <label class="street-field">
                    Straße und Hausnummer
                    <input type="text" id="p-street" placeholder="Musterstraße 123" maxlength="100">
                </label>
    
                <label>
                    Postleitzahl
                    <input type="text" id="p-zip" placeholder="12345" maxlength="10">
                </label>
    
                <label>
                    Ort
                    <input type="text" id="p-city" placeholder="Musterstadt" maxlength="50">
                </label>
            </div>
          </div>

          <div class="form-actions span-2">
              <button type="submit">Änderungen speichern</button>
              <button id="btn-discard-profile" type="button" class="secondary">Verwerfen</button>
          </div>
      </form>
  </section>
  
    <section id="view-report-reason" class="view" hidden>
        <button id="btn-back-from-report-reason" class="btn-link" type="button">← Zurück zur Anzeige</button>
        <h2>Anzeige melden</h2>
        <p>Bitte wähle einen Grund für die Meldung aus. Deine Meldung ist anonym.</p>
        <form id="report-reason-form" class="report-form">
            <div class="radio-group vertical">
                <label><input type="radio" name="report-reason" value="unpassender-inhalt" required> Unpassender Inhalt</label>
                <label><input type="radio" name="report-reason" value="anstoessig-beleidigend"> Anstößiger oder beleidigender Inhalt</label>
                <label><input type="radio" name="report-reason" value="gewerblich"> Mutmaßlich gewerblicher Anbieter</label>
                <label><input type="radio" name="report-reason" value="betrug-verdaechtig"> Verdächtiger oder betrügerischer Inhalt</label>
                <label><input type="radio" name="report-reason" value="faelschung"> Fälschung</label>
                <label><input type="radio" name="report-reason" value="sonstiges"> Sonstiges</label>
            </div>
            <div class="form-actions">
                <button type="submit">Weiter</button>
                <button type="button" id="btn-cancel-report-1" class="secondary">Abbrechen</button>
            </div>
        </form>
    </section>

    <section id="view-report-details" class="view" hidden>
        <button id="btn-back-from-report-details" class="btn-link" type="button">← Zurück zur Auswahl</button>
        <h2>Grund für die Meldung</h2>
        <p>Bitte beschreibe möglichst genau, warum du diese Anzeige meldest.</p>
        <form id="report-details-form" class="report-form">
            <textarea id="report-description" rows="6" placeholder="Deine Beschreibung (optional)" maxlength="1000"></textarea>
            <div class="form-actions">
                <button type="submit">Anzeige melden</button>
                <button type="button" id="btn-cancel-report-2" class="secondary">Abbrechen</button>
            </div>
        </form>
    </section>

  </main>

  <footer class="site-footer">
    <div class="wrap">
      <small>© 2025 Hilfe-Plattform (Demo)</small>
    </div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <div id="auth-modal" class="modal-overlay" hidden>
    <div class="modal-content">
      <button id="close-modal-btn" class="close-btn" aria-label="Schließen">&times;</button>
      <div id="login-view">
        <h2>Anmelden</h2>
        <form id="login-form">
          <label>Email <input type="email" id="login-email" required></label>
          <label>
            Passwort
            <div class="password-wrapper">
              <input type="password" id="login-password" required>
              <button type="button" id="toggle-login-password" class="password-toggle" aria-label="Passwort anzeigen">
                </button>
            </div>
          </label>
          <button type="submit">Anmelden</button>
          <p style="text-align: center; margin-top: 15px; font-size: 0.9em;">
            <a href="#" id="forgot-password-link">Passwort vergessen?</a>
          </p>
        </form>
        <p>Noch kein Konto? <a href="#" id="show-register">Jetzt registrieren</a></p>
      </div>
      <div id="register-view" hidden>
        <h2>Registrieren</h2>
        <form id="register-form">
         <label>Nutzername
  <input type="text" id="register-username" required minlength="3" maxlength="20">
  <small id="register-username-hint" class="field-hint" hidden></small>
</label>
          <label>Email <input type="email" id="register-email" required></label>
          <label>
  Passwort
  <div class="password-wrapper">
    <input type="password" id="register-password" required minlength="8">
    <button type="button" id="toggle-register-password" class="password-toggle" aria-label="Passwort anzeigen"></button>
  </div>
  <div id="password-criteria" style="font-size: 0.8em; font-weight: normal; margin-top: 8px; color: var(--muted);" hidden>
    <p id="pw-length">Mindestens 8, max. 16 Zeichen</p>
    <p id="pw-uppercase">Mindestens ein Großbuchschtabe </p>
    <p id="pw-number">Mindestens eine Zahl </p>
  </div>
</label>
          <button type="submit">Registrieren</button>
        </form>
        <p>Bereits ein Konto? <a href="#" id="show-login">Zum Login</a></p>
      </div>
    </div>
  </div>

  <div id="reset-confirm-modal" class="modal-overlay" hidden>
    <div class="modal-content" style="text-align: center;">
      <h2>E-Mail versendet</h2>
      <p>Wir haben eine E-Mail zum Zurücksetzen deines Passworts an die angegebene Adresse gesendet.</p>
      <p style="font-weight: bold;">Bitte überprüfe auch deinen Spam-Ordner!</p>
      <div id="resend-container" style="margin-top: 20px; min-height: 40px;">
        </div>
      <button id="close-confirm-modal-btn" class="secondary" style="margin-top: 10px;">Schließen</button>
    </div>
  </div>

  <div id="verify-email-modal" class="modal-overlay" hidden>
    <div class="modal-content" style="text-align: center;">
      <h2>Bestätigung erforderlich</h2>
      <p>Wir haben dir eine E-Mail gesendet. Bitte klicke auf den Link in der E-Mail, um dein Konto zu aktivieren.</p>
      <p>Nachdem du deine E-Mail erfolgreich Verifiziert hast, kannst du diese Fenster schließen und dich anmelden.</p>
      <p style="font-weight: bold;">Überprüfe bitte auch deinen Spam-Ordner!</p>
      <button id="close-verify-modal-btn" class="secondary" style="margin-top: 10px;">Schließen</button>
    </div>
  </div>

  <div id="confirm-modal" class="modal-overlay" hidden>
    <div class="modal-content" style="max-width: 420px; text-align: center;">
        <h2 id="confirm-modal-title">Wirklich löschen?</h2>
        <p id="confirm-modal-text">Bist du sicher, dass du diese Aktion ausführen möchtest? Dies kann nicht rückgängig gemacht werden.</p>
        <div class="form-actions" style="justify-content: center; margin-top: 20px;">
            <button id="confirm-modal-confirm-btn" class="danger">Löschen</button>
            <button id="confirm-modal-cancel-btn" class="secondary">Abbrechen</button>
        </div>
    </div>
  </div>

  <div id="share-modal" class="modal-overlay" hidden>
    <div class="modal-content">
        <button id="close-share-modal-btn" class="close-btn" aria-label="Schließen">&times;</button>
        <h2>Anzeige teilen</h2>
        <p>Teile diesen Link, um die Anzeige weiterzugeben.</p>
        <div class="share-link-container">
            <input type="text" id="share-link-input" readonly>
            <button id="copy-share-link-btn">Kopieren</button>
        </div>
        <div class="share-socials">
            <a id="share-whatsapp" href="#" target="_blank">WhatsApp</a>
            <a id="share-email" href="#">E-Mail</a>
        </div>
    </div>
  </div>

  <div id="admin-report-modal" class="modal-overlay" hidden>
      <div class="modal-content" style="max-width: 550px;">
          <button id="close-admin-report-modal-btn" class="close-btn" aria-label="Schließen">&times;</button>
          <h2>Meldung überprüfen</h2>
          <div id="admin-report-details">
            <p><strong>Anzeige:</strong> <span id="admin-report-ad-title"></span></p>
            <p><strong>Grund:</strong> <span id="admin-report-reason"></span></p>
            <p><strong>Beschreibung:</strong></p>
            <div id="admin-report-description"></div>
          </div>
          <div class="form-actions" style="margin-top: 20px; justify-content: space-between;">
              <button id="admin-delete-ad-btn" class="danger">Anzeige löschen</button>
              <button id="admin-view-ad-btn" type="button" class="secondary">Anzeige ansehen</button>
              <button id="admin-dismiss-report-btn" class="secondary">Als Erledigt markieren</button>
          </div>
      </div>
  </div>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail, updateProfile, sendEmailVerification } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyB06YP-PZgaviKEVvG_APz8O2ITy6BuvPs",
      authDomain: "help4y-375f6.firebaseapp.com",
      projectId: "help4y-375f6",
      storageBucket: "help4y-375f6.appspot.com",
      messagingSenderId: "251326720035",
      appId: "1:251326720035:web:e540fb9aed31d3dba02996",
      measurementId: "G-MHFQS6DXD5"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);


    window.firebaseAuth = {
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        auth,
        sendPasswordResetEmail,
        updateProfile,
        sendEmailVerification
    };

  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, query, orderBy, serverTimestamp, setDoc, updateDoc, getDoc, arrayUnion, arrayRemove, writeBatch, where }
  from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const db = getFirestore(app);

// Für globale Nutzung
window.firebaseDb = {
    db,
    collection,
    addDoc,
    getDocs,
    deleteDoc,
    doc,
    onSnapshot,
    query,
    orderBy,
    serverTimestamp,
    setDoc,
    updateDoc,
    getDoc,
    arrayUnion,
    arrayRemove,
    writeBatch, 
    where
};


  </script>

  <script src="app.js" defer></script>
</body>
</html>